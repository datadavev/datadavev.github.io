<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Looking for Validation</title>
  <meta name="description" content="Validating XML against the cited schema makes sure that the XML is at least structured correctly, and helps ensure that consumers of the XML have some guaran...">

  <!-- Google Fonts loaded here depending on setting in _data/options.yml true loads font, blank does not-->
  

  <!-- Load up MathJax script if needed ... specify in /_data/options.yml file-->
  
    <script type="text/javascript" src="//cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js"></script>
  

  <link rel="stylesheet" type="text/css" href="/css/dave.css">
  <link rel="stylesheet" type="text/css" href="/css/latex.css">
  <link rel="stylesheet" type="text/css" href="/css/print.css" media="print">

  <script type="text/javascript" src="/js/jquery-2.1.1.min.js"></script>

  <link rel='stylesheet prefetch' href='/css/lightgallery.min.css'>
  <link rel='stylesheet prefetch' href='/css/justifiedGallery.min.css'>
  <script src='/js/picturefill.min.js'></script>
  <script src='/js/jquery.mousewheel.min.js'></script>
  <script src='/js/lightgallery-all.min.js'></script>
  <script src='/js/jquery.justifiedGallery.min.js'></script>
  <script src='/js/index.js'></script>

  <link rel="canonical" href="/articles/xml/python/2017/12/13/validation.html">

  <link rel="alternate" type="application/rss+xml" title="Dave's Notes" href="/feed.xml" />
</head>

  <body>
    <!--- Header and nav template site-wide -->
<header>
	
		<h1 class="header-title"><a href="/">Dave's Notes</a></h1>
		
			<h2 class="header-subtitle">Absence of evidence is not evidence of absence</h2>
		
	

    <nav class="group">
	
	
		
  	
		
  	
		
  	
		
  	
		
		    
		      <a href="/">About</a>
		    
	    
  	
		
		    
		      <a href="/notes/">Notes</a>
		    
	    
  	
		
		    
		      <a href="/page/tufte">Tufte CSS</a>
		    
	    
  	
		
		    
		      <a href="/page/sorgone">Schema.org</a>
		    
	    
  	
	</nav>
</header>
    <article class="group">
      <h1>Looking for Validation</h1>
<p class="subtitle">December 13, 2017</p>

<p>Validating XML against the cited schema makes sure that the XML is at least structured correctly, and helps ensure that consumers of the XML have some guarantees about what to expect.</p>

<!--more-->

<p>Validation can be done pragmatically with a couple of commonly available tools, typically coming down to a choice of <code class="highlighter-rouge">libxml2</code> for C and Python or <code class="highlighter-rouge">Xerces</code> for Java. The examples here are for the Python <code class="highlighter-rouge">lxml</code> library, which uses <code class="highlighter-rouge">libxml2</code> under the hood.</p>

<p>In a nutshell:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="n">CATALOG</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">"~/xmlcatalogs/catalog.xml"</span><span class="p">)</span>

<span class="c"># Note: do this before importing lxml</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">"XML_CATALOG_FILES"</span><span class="p">]</span><span class="o">=</span><span class="s">"file://"</span> <span class="o">+</span> <span class="n">CATALOG</span>

<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>

<span class="n">xsd</span> <span class="o">=</span> <span class="s">"http://www.ngdc.noaa.gov/metadata/published/xsd/schema.xsd"</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">XMLSchema</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">xsd</span><span class="p">)</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">"samples/iso_01.xml"</span><span class="p">,</span><span class="s">"r"</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>

<span class="n">invalid_doc</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">"samples/iso_02_cn-invalid.xml"</span><span class="p">,</span><span class="s">"r"</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">invalid_doc</span><span class="p">)</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="n">DocumentInvalid</span>                           <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="n">aaa63f2f66c4</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">s</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">invalid_doc</span><span class="p">)</span>

<span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">etree</span><span class="o">.</span><span class="n">pyx</span> <span class="ow">in</span> <span class="n">lxml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">_Validator</span><span class="o">.</span><span class="n">assertValid</span> <span class="p">(</span><span class="n">src</span><span class="o">/</span><span class="n">lxml</span><span class="o">/</span><span class="n">etree</span><span class="o">.</span><span class="n">c</span><span class="p">:</span><span class="mi">194448</span><span class="p">)()</span>

<span class="n">DocumentInvalid</span><span class="p">:</span> <span class="n">Element</span> <span class="s">'{http://www.isotc211.org/2005/gmd}CI_Address'</span><span class="p">:</span> <span class="n">This</span> <span class="n">element</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">expected</span><span class="o">.</span> <span class="n">Expected</span> <span class="ow">is</span> <span class="n">one</span> <span class="n">of</span> <span class="p">(</span> <span class="p">{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">isotc211</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">2005</span><span class="o">/</span><span class="n">gmd</span><span class="p">}</span><span class="n">characterSet</span><span class="p">,</span> <span class="p">{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">isotc211</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">2005</span><span class="o">/</span><span class="n">gmd</span><span class="p">}</span><span class="n">parentIdentifier</span><span class="p">,</span> <span class="p">{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">isotc211</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">2005</span><span class="o">/</span><span class="n">gmd</span><span class="p">}</span><span class="n">hierarchyLevel</span><span class="p">,</span> <span class="p">{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">isotc211</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">2005</span><span class="o">/</span><span class="n">gmd</span><span class="p">}</span><span class="n">hierarchyLevelName</span><span class="p">,</span> <span class="p">{</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">isotc211</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="mi">2005</span><span class="o">/</span><span class="n">gmd</span><span class="p">}</span><span class="n">contact</span> <span class="p">)</span><span class="o">.</span><span class="p">,</span> <span class="n">line</span> <span class="mi">7</span>

</code></pre></div></div>

<p>The <code class="highlighter-rouge">XML_CATALOG_FILES</code> environment can also be set outside the app doing the validation.</p>

<p>Note that the call to <code class="highlighter-rouge">etree.XMLSchema()</code> does not honor the default practice of <code class="highlighter-rouge">lxml</code> for no network access, and will in fact retrieve any referenced schemas from the network if those URIs are not resolved in the catalog.</p>



    </article>
    <span class="print-footer">Looking for Validation - December 13, 2017 - Dave Vieglais</span>
    <footer>
<div class="credits">
<span>&copy; 2018 
  
		<a href="mailto:dave [dot] vieglais [at] gmail">Dave Vieglais</a></span></br> <br>    
    

</div>  
</footer>
  </body>
</html>
